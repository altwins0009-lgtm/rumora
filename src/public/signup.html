<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up | Rumora</title>
    <script src="https://cdn.clerk.com/clerk-js.v4.13.0.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 40px;
            background: #0f0b1f;
            color: white;
            font-family: sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            width: 100%;
            max-width: 500px;
            text-align: center;
        }
        .logo {
            font-size: 3rem;
            color: #9d4edd;
            margin-bottom: 20px;
        }
        h1 {
            background: linear-gradient(90deg, #e0aaff, #c77dff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        #clerk-container {
            min-height: 400px;
            margin: 30px 0;
        }
        .status {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
            text-align: left;
        }
        .success { color: #4ade80; }
        .error { color: #ef4444; }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">‚ú®</div>
        <h1>Join Rumora</h1>
        <p>Create your account to access magical features</p>
        
        <div id="clerk-container">
            <div style="padding: 40px; color: #aaa;">
                <div class="loading-spinner" style="width: 40px; height: 40px; border: 3px solid rgba(157, 78, 221, 0.3); border-top-color: #9d4edd; border-radius: 50%; margin: 0 auto 20px; animation: spin 1s linear infinite;"></div>
                <p>Loading authentication...</p>
            </div>
        </div>
        
        <div class="status" id="status">
            Initializing Clerk...
        </div>
    </div>

    <script>
        // === YOUR LIVE CLERK KEY ===
        const CLERK_PUBLISHABLE_KEY = 'pk_live_Y2xlcmsucnVtb3JhLmZyaWkuc2l0ZSQ';
        const CLERK_FRONTEND_API = 'https://clerk.rumora.frii.site';
        
        const statusEl = document.getElementById('status');
        
        function updateStatus(message, type = 'info') {
            const color = type === 'error' ? '#ef4444' : type === 'success' ? '#4ade80' : '#eab308';
            statusEl.innerHTML = `<span style="color: ${color}">${message}</span>`;
            console.log('Clerk Status:', message);
        }
        
        // Initialize Clerk with custom domain
        async function initializeClerk() {
            updateStatus('Starting Clerk initialization...');
            
            // Validate key
            if (!CLERK_PUBLISHABLE_KEY || !CLERK_PUBLISHABLE_KEY.startsWith('pk_')) {
                updateStatus('‚ùå Invalid Clerk key format', 'error');
                return;
            }
            
            updateStatus(`‚úÖ Using Clerk key: ${CLERK_PUBLISHABLE_KEY.substring(0, 20)}...`);
            
            // Wait for Clerk SDK to load
            let attempts = 0;
            const waitInterval = setInterval(() => {
                attempts++;
                
                if (window.Clerk) {
                    clearInterval(waitInterval);
                    loadClerk();
                } else if (attempts > 10) {
                    clearInterval(waitInterval);
                    updateStatus('‚ùå Clerk SDK failed to load', 'error');
                } else {
                    updateStatus(`Waiting for Clerk SDK... (${attempts}/10)`);
                }
            }, 500);
        }
        
        // Load Clerk with custom configuration
        async function loadClerk() {
            try {
                updateStatus('Configuring Clerk with custom domain...');
                
                // IMPORTANT: Use the custom frontend API URL
                await Clerk.load({
                    publishableKey: CLERK_PUBLISHABLE_KEY,
                    frontendApi: CLERK_FRONTEND_API
                });
                
                updateStatus('‚úÖ Clerk configured successfully!', 'success');
                
                // Mount sign-up component
                Clerk.mountSignUp(document.getElementById('clerk-container'), {
                    appearance: {
                        variables: {
                            colorPrimary: '#9d4edd',
                            colorText: '#ffffff',
                            colorBackground: 'transparent'
                        }
                    },
                    signUp: {
                        // Optional: Customize sign-up behavior
                    }
                });
                
                updateStatus('‚úÖ Sign-up form ready!', 'success');
                
                // Listen for successful sign-up
                Clerk.addListener(({ user }) => {
                    if (user) {
                        updateStatus('üéâ Account created! Redirecting to dashboard...', 'success');
                        
                        // Store user session
                        localStorage.setItem('rumora_user_id', user.id);
                        localStorage.setItem('rumora_user_email', user.primaryEmailAddress.emailAddress);
                        
                        // Redirect after 1 second
                        setTimeout(() => {
                            window.location.href = '/testing/dashboard';
                        }, 1000);
                    }
                });
                
                // Handle errors
                Clerk.addListener(({ error }) => {
                    if (error) {
                        updateStatus(`‚ö†Ô∏è Clerk error: ${error.message}`, 'error');
                    }
                });
                
            } catch (error) {
                updateStatus(`‚ùå Clerk initialization failed: ${error.message}`, 'error');
                console.error('Clerk error details:', error);
            }
        }
        
        // Start initialization when page loads
        document.addEventListener('DOMContentLoaded', initializeClerk);
        
        // Add spinner animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
